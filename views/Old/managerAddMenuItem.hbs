<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, shrink-to-fit=no"
    />
    <title>Menu</title>
    <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
    />
    <link
    rel="stylesheet"
    href="https://pro.fontawesome.com/releases/v6.0.0-beta1/css/all.css"
    />
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj" crossorigin="anonymous"></script>
</head>

{{> navbarManager}}

<body>
    <div class="bg-light p-3" style="height: 96vh">
        <div class="card border-3" style="border-bottom-color: #0d6efd">
            <div class="card-body rounded">
                <h3 class="text-secondary">Create Menu Item</h3>
            </div>
        </div>
        <div class="row">
            <div class="col-md-4 mt-3">
                <div class="card">
                    <div
                    class="card-body rounded mb-3"
                    style="height: 67vh"
                    >
                    <button
                    class="btn btn-info rounded-pill float-end"
                    type="button"
                    id="save"
                    >
                    <i class="fa fa-edit"></i> Save 
                </button>
                <input id="menuItem" type="text" name="menuItem"  placeholder="Name" >
                <hr class="my-3" style="color: black" />
                <div class="row">
                    <div class="col">
                        <h5 class="">Price:</h5>
                    </div>
                    <div class="text-end col">
                        <input
                        type="number"
                        class="price text-end"
                        style="width: 120px"
                        name="Price"
                        min="0"
                        id="price"

                        />
                    </div>
                </div>
                <hr />
                <div class="row">
                    <span class="col">
                        <span
                        class="d-flex justify-content-between"
                        >
                        <h3 class="status">Status:</h3>
                        active 
                    </span>
                </span>

                <div
                class="delete-menu-item"
                style="margin-top: 150px"
                ></div>
            </div>
        </div>
    </div>
</div>

<div class="col-md-8 mt-3">
    <div class="card">
        <div
        class="card-body overflow-auto rounded"
        style="height: 70vh"
        >
        <div>
            <h2>Recipe</h2>
            <form class="col">
                <div class="d-flex mb-3">
                    <select
                    id="ingredient"
                    class="form-select"
                    name="ingredient"
                    required
                    style="width: 150px"
                    >
                    <option selected>Ingredient</option>
                    {{#each ingredient}}
                    <option
                    value="{{{ingredientName}}}"
                    >
                    {{ingredientName}}
                </option>
                {{/each}}
            </select>

            <!-- Button trigger modal -->
            <button type="button" class="btn btn-warning col-2 ms-3" data-bs-toggle="modal" data-bs-target="#exampleModal">
                <i class="fa-solid fa-circle-plus"></i>
                Add Ingredient
            </button>

            <!-- Modal -->
            <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-body">
                            ...
                            <section>
                                <div class="card position-absolute top-10 start-50 translate-middle" style="width: 100vh">
                                    <div style="background-color:#F8F5F1;">
                                        <form action="/inventory/addIngredient" method="POST" class="m-4 pb-5">
                                            <header class="pb-3">
                                                <h3>Add Ingredient</h3>
                                            </header>

                                            <section>
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text col-4 bg-info" id="basic-addon3">Ingredient Name</span
                                                    >
                                                    <input 
                                                    type="text"
                                                    class="form-control"
                                                    id="purchased-ingredient-name"
                                                    aria-describedby="basic-addon3"
                                                    name="name"
                                                    />
                                                </div>


                                                <div class="input-group mb-3">
                                                  <span
                                                  class="input-group-text col-4 bg-info"
                                                  id="basic-addon3"
                                                  >Unit Of Measurement</span
                                                  >
                                                  <select
                                                  class="form-select"
                                                  name="uom"
                                                  >
                                                  <option selected>Choose...</option>
                                                  {{#each uom}}
                                                  <option value="{{{abbrev}}}">{{abbrev}}</option>
                                                  {{/each}}
                                              </select>

                                          </div>

                                          <div class="input-group mb-3">
                                              <span
                                              class="input-group-text col-4 bg-info"
                                              id="basic-addon3"
                                              >Reorder Point</span
                                              >
                                              <input
                                              type="number"
                                              min="0"
                                              class="form-control"
                                              id="purchased-quantity-per-stock"
                                              aria-describedby="basic-addon3"
                                              name="reorderPoint"
                                              />
                                          </div>

                                          <div class="float-end">
                                             <button type="button" class="btn btn-secondary mx-3" data-bs-dismiss="modal">Cancel</button>  
                                             <button type="submit" class="d-inline float-end btn btn-m bg-info">
                                                Save
                                            </button>
                                        </div>
                                    </section>
                                </form>
                            </div>
                        </div>
                    </section>



                </div>

            </div>
        </div>
    </div>

    <input
    type="number"
    class="mx-3 form-control"
    style="width: 80px"
    min="0"
    name="qty"
    id="qty"
    placeholder="Qty"
    />

    <select
    id="unit"
    class="form-select"
    name="unit"
    required
    style="width: 90px"
    >
    <option selected>Unit</option>
    {{#each uom}}
    <option value="{{{abbrev}}}">
        {{abbrev}}
    </option>
    {{/each}}
</select>
<button type="button" class="btn btn-info rounded ms-3 float-end"><a class="text-dark" style="text-decoration: none" href="/getAddUOMManager">Add Uom</a></button>

<button
class="btn mb-2 ms-5 btn-primary rounded-pill float-end"
type="button"
id="addIngredient"
>
<i
class="fa-regular fa-square-plus"
></i>
Add Menu Ingredient
</button>
</div>
</form>
</div>
<div class="table-responsive rounded">
    <table class="table overflow-auto">
        <thead>
            <tr class="bg-success text-light">
                <th class="text-center">
                    Ingredient Name
                </th>
                <th class="text-center">
                    Quantity
                </th>
                <th class="text-center">
                    UOM
                </th>
                <th class="text-center"></th>
            </tr>
        </thead>
        <tbody id="ingredientsTable">

        </tbody>
    </table>
</div>
</div>
</div>

</div>
</div>
</div>

<script>
    $(document).ready(() => {
        var listIngredient = [];
        var listUnit = [];
        var listQuantity = [];
        var listIndex = [];
        var index = 0;
        $("#addIngredient").click(() => {
            const ingredient = $("#ingredient").val();
            const quantity = $("#qty").val();
            const unit = $("#unit").val();

            if (
                ingredient == "Ingredient" ||
                quantity == "" ||
                unit == "Unit" 
                )
                alert(
                    "Please input the appropriate input in all fields!"
                    );
            else {
                let ingredientInfo =  `<tr id="row`+index+`">
                <td>`+ingredient+`</td>
                <td class="text-center">`+quantity+`</td>
                <td class="text-center">`+unit+`</td>
                <td class="text-center"><button class="btn btn-danger btn_remove mb-2 remove" name='remove' id="` +
                index +
                `">X</button></td>
                </tr>`;


                $("#ingredientsTable").append(ingredientInfo);

                $("#ingredient").prop("selectedIndex", 0);
                $("#unit").prop("selectedIndex", 0);
                $("#qty").val("");
                //store it in array 
                listIngredient.push(ingredient);
                listQuantity.push(quantity);
                listUnit.push(unit);
                listIndex.push(index);
                index++;
            }

        });

        $(document).on("click", ".remove", function () {
          const button_id = $(this).attr("id");
          $(`#row` + button_id + ``).remove();
          let i = button_id;
          let num = listIndex.findIndex(item => item == i);
          
          listIngredient.splice(num, 1);
          listUnit.splice(num, 1);
          listQuantity.splice(num, 1);
          listIndex.splice(num,1);
          alert(listIngredient);
      });

        

        $("#save").click( () => {
            const ingredient = $("#ingredient").val();
            const quantity = $("#qty").val();
            const unit = $("#unit").val();
            const name = $("#menuItem").val();
            const price = $("#price").val();
            if (
                name == "" ||
                price == ""
                )
                alert(
                    "Please input the appropriate input in all fields!"
                    );
            else {
                $.get("/addMenuItem", {
                    menuItem: name,
                    price: price,
                    listIngredient: listIngredient,
                    listQuantity: listQuantity,
                    listUnit: listUnit
                }, result => {
                    console.log(result);
                    listIngredient = [];
                    listQuantity = [];
                    listUnit = [];
                    alert('Created Menu Item!');
                    window.location.replace(result.url);
                });
            }

        });

        // whendadidng in database change status of previous menu item to inactive and then make a copy then insert the added
    });
</script>
</body>
</html>
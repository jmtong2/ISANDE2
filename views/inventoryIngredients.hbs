<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
  <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v6.0.0-beta1/css/all.css">

  <!-- Datepicker -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>

  <title>Document</title>
</head>
<body style="background-color: #E6E6DE ">

  <style>
    @media print {
      body * {
        visibility: hidden !important;
      }
      .print-container, .print-container * {
        visibility: visible !important;
      }
      .print-container {
        position: absolute !important;
        /*Adjust depending on the size to align it to the center*/
        left: 0vh !important;
        top: -55vh !important;
      }
    }

  </style>
  <title>Inventory</title>

</head>

<body>

  
 {{> navbarInventory}} 

  <div class=" p-3" >
    <div class="card">
      <div class="card-body rounded shadow" style="background-color: #CC985A">
        <h3 class="text-light mb-3">Inventory</h3>
        <div class="d-flex justify-content-between">
          <div class="col">
            <div class="row">
                <label  style="width: 120px" class="form-label mt-2 text-light">Date Created</label>
              <div class="col-sm-2">
                <div class="input-group date" id="startDate">
                  <input type="text" class="form-control">
                  <span class="input-group-append">
                    <span class="input-group-text bg-white d-block">
                      <i class="fa fa-calendar"></i>
                    </span>
                  </span>
                </div>
              </div>

              <label  style="width: 45px" class="form-label mt-2 text-light">To</label>
              <div class="col-sm-2">
                <div class="input-group date" id="endDate">
                  <input type="text" class="form-control">
                  <span class="input-group-append">
                    <span class="input-group-text bg-white d-block">
                      <i class="fa fa-calendar"></i>
                    </span>
                  </span>
                </div>
              </div>   

              <div class="col text-end">
               <p style="color: #243b31">(*Click the row of the ingredient to edit the Reorder Point and Economic Order Quantity)</p>
              </div>     
      </div>
    </div>


  </div>
</div>
</div>

<div class="d-flex m-2 flex-row justify-content-between">
  <div class="p-2 mt-1">As of November 21, 2021</div>
  <div class="p-2 "><button class="btn btn-secondary" style="background-color: #7CA6A6" onclick="window.print();"><i class="fas fa-file-download"></i> Download</button></div>

</div>

<div class="col-md-12">

  <div class="card ">
    <div class="card-body overflow-auto  border rounded shadow-lg bg-light ">
      <div class="table-responsive rounded print-container">
        <table class="table overflow-auto table-hover table-hover table-bordered table-striped  ">
          <div id="reportTitle" class="text-center my-3 " >
            <h4>Inventory Summary Report</h4>
            <h5>November 1-31, 2021</h5>
             <h6 class="p-2 mt-1 text-end">Row/s: {{inventory.length}}</h6>
          </div>
          <thead>
            <tr class="text-light align-top" style="background-color: #7CA6A6">
              <th class="text-center">Ingredient</th>
              <th class="text-center"style="width: 200px">Total Quantity (TQ)</th>
              <th class="text-center"style="width: 200px">Quantity Per Stock</th>
              <th class="text-center"style="width: 200px">Reorder Point</th>
              <th class="text-center"style="width: 200px">Economic Order Quantity</th>
              <th class="text-center">Status</th>
             <!--  <th></th> -->
            </tr>
          </thead>
          <tbody>
            
             {{#each inventory}}
            <tr>
              <td class="text-center">{{ingredientName}}</td>
              <td class="text-end">{{totalQuantity}} {{uom.abbrev}}</td>
              <td class="text-end">{{quantityPerStock}} {{uom.abbrev}}</td>
              <td style="display:none;" >{{uom.fullName}}</td>
              <td class="text-end">{{reorderPoint}} {{uom.abbrev}}</td>
              <td class="text-end">{{economicOrderQuantity}} {{uom.abbrev}}</td>

              <td style="text-align:center;">
                {{#isGreaterThan reorderPoint totalQuantity}}
                    <button type="button" class="btn btn-warning">Low Stock</button>
                {{else}}
                    <button type="button" class="btn btn-success">Sufficient Stock</button>
                {{/isGreaterThan}}
              </td>
              <!-- <td class="text-center"><i class="fa-solid fa-pen-to-square"></i></td> -->
            </tr>
            {{/each}}
          </tbody>
        </table>

<h6 class="text-center">**END OF REPORT**</h6>
      </div>
      
    </div>

  </div>
</div>
</div>


<!-- Modal -->
              <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                  <div class="modal-content">
                    <div class="modal-body">
                     <section>
                      <div class="card position-absolute top-10 start-50 translate-middle" style="width: 700px">
                        <div style="background-color:#F8F5F1;">
                          <form action="/purchasing/edit" method="PATCH" class=" p-2">
                            <header class="p-4">
                              <h3>Edit Ingredient</h3>
                            </header>

                            <section>
                              <div class="input-group px-4 mb-3">
                                <span class="input-group-text col-4 bg-success text-light" >Ingredient</span
                                >
                                <div class="row col-8">
                                  <input 
                                  type="text"
                                  class="form-control  ingredientName"
                                  id="ingredient-name"
                                  aria-describedby="basic-addon3"
                                  
                                  disabled
                                  required
                                  />
                                 
                                </div>
                              </div>

                          <div class="input-group px-4 mb-3">
                            <span
                            class="input-group-text col-4 bg-success text-light"
                            >Quantity On Hand</span
                            >
                            <input 
                                type="text"
                                class="form-control col-1 text-end totalQuantity"
                                aria-describedby="basic-addon3"
                                disabled
                                />
                          </div>

                          <div class="input-group px-4 mb-3">
                            <span
                            class="input-group-text col-4 bg-success text-light"
                            >Quantity Per Stock</span
                            >
                            <input 
                                type="text"
                                class="form-control col-1 text-end quantityPerStock"
                                aria-describedby="basic-addon3"
                                disabled
                                />
                          </div>

                          <div class="input-group px-4 mb-3">
                              <span
                              class="input-group-text col-4 bg-success text-light"
                              id="basic-addon3"
                              name="unitOfMeasurement"
                              >Unit of Measurement</span
                              >
                              <input 
                                type="text"
                                class="form-control text-start ingredientUOM"
                                aria-describedby="basic-addon3"
                                name="uom"
                                disabled
                                />
                          </div>

                           <div class="input-group px-4 mb-3">
                            <span
                            class="input-group-text col-4 bg-success text-light"
                            >Reorder Point</span
                            >
                            <input 
                                type="number"
                                class="form-control col-1 text-end reorderPoint"
                                aria-describedby="basic-addon3"
                                
                                />
                          </div>

                          <div class="input-group px-4 mb-3">
                            <span
                            class="input-group-text col-4 bg-success text-light"
                            >Economic Order Quantity</span
                            >
                            <input 
                                type="number"
                                class="form-control col-1 text-end economicOrderQuantity"
                                aria-describedby="basic-addon3"
                                
                                />
                          </div>

                      

                        <div class="float-end m-3">
                         <button type="button" class="btn btn-secondary mx-3 text-light" data-bs-dismiss="modal">Cancel</button>  
                         <button type="submit" class="d-inline float-end btn btn-m text-light" id="save-edited" style="background-color: #7CA6A6">
                          Save
                        </button>
                      </div>
                    </section>
                  </form>
                </div>
              </div>
            </section>
          </div>

        </div>
      </div>
    </div>

    <!-- End -->

<script>

  $(document).ready( () => {

    $(function() {
      $('#startDate').datepicker();
    });

    $(function() {
      $('#endDate').datepicker();
    });

    var clickedIngredientName = "";
    var clickedIngredientQOH = 0;
    var clickedIngredientQPS = 0;
    var clickedIngredientUOM = "";
    var clickedIngredientReorderPoint = 0;
    var clickedIngredientEOQ = 0;

    $('table tbody tr  td').on('click',function(){
      $("#editModal").modal("show");
      $(".ingredientName").val($(this).closest('tr').children()[0].textContent);
      $(".totalQuantity").val($(this).closest('tr').children()[1].textContent);
      $(".quantityPerStock").val($(this).closest('tr').children()[2].textContent);
      $(".ingredientUOM").val($(this).closest('tr').children()[3].textContent);
      $(".reorderPoint").val($(this).closest('tr').children()[4].textContent).replace(/ .*/,'');
      $(".economicOrderQuantity").val($(this).closest('tr').children()[5].textContent).replace(/ .*/,'');

      /*clickedIngredientName = $(".ingredientName").val();
      clickedIngredientQOH = $(".totalQuantity").val();
      clickedIngredientQPS = $(".quantityPerStock").val();
      clickedIngredientUOM = $(".ingredientUOM").val();
      clickedIngredientReorderPoint = $(".reorderPoint").val().replace(/ .,'');
      clickedIngredientEOQ = $(".economicOrderQuantity").val().replace(/ .,''); */

    });




    $('#save-edited').click( () => {
      clickedIngredientReorderPoint = $(".reorderPoint").val().replace(/ .*/,'');
      clickedIngredientEOQ = $(".economicOrderQuantity").val().replace(/ .*/,'');
      clickedIngredientName = $(".ingredientName").val();
      $.post("/setReorderEOQ", {
          ingredientName: clickedIngredientName,
          reorderPoint: clickedIngredientReorderPoint,
          economicOrderQuantity: clickedIngredientEOQ
        },
        ingredient => {

         window.location.reload();
        });
    });
    
  });





</script>

</body>



</html>